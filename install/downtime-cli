#!/usr/bin/env python3
import os
import sys
import time
import subprocess
sys.path.append("/usr/bin/downtime/")
import dbget
def register():
    print("Ready to Register.")
    os.system("touch /tmp/registration.downtime.lock")
    tcyc = 0
    while tcyc != 30:
        os.system("touch /tmp/registration.downtime.lock")
        if os.path.exists("/tmp/registration.downtime.lock") == False:
            print("Registration Complete.")
            exit()
        time.sleep(1)
        tcyc = tcyc + 1
    print("Registration Timeout.")
    os.system("rm -rf /tmp/registration.downtime.lock")
#check if downtime service is running
if subprocess.getoutput("systemctl is-active downtime") != "active":
    print("Starting Downtime...")
    os.system("systemctl start downtime")
    time.sleep(5)
    if subprocess.getoutput("systemctl is-active downtime") != "active":
        print("Downtime Failed to Start!")
        exit()
if sys.argv[1] == "register":
    register()
